<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bill Tracker Pro</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; }
        body { 
            font-family: -apple-system, sans-serif; background: #f0f2f5; margin: 0; padding: 10px;
            overflow-x: hidden; width: 100vw; position: fixed; height: 100%; 
        }
        .scroll-container { height: 100%; overflow-y: auto; padding-bottom: 120px; box-sizing: border-box; }
        .container { max-width: 500px; margin: auto; }
        .controls { background: var(--primary); color: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; display: flex; gap: 10px; }
        select, input { padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; width: 100%; box-sizing: border-box;}
        .summary-view { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 5px solid var(--secondary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-weight: bold; }
        .week-block { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .week-header { background: var(--secondary); color: white; padding: 10px; border-radius: 6px; margin: -15px -15px 15px -15px; font-size: 14px; display: flex; justify-content: space-between; font-weight: bold; }
        h3 { font-size: 12px; margin: 15px 0 8px 0; color: #888; text-transform: uppercase; border-bottom: 1px solid #eee; padding-bottom: 3px; }
        .row { display: flex; gap: 4px; margin-bottom: 8px; align-items: center; }
        .row.paid { background: #d4edda; border-radius: 6px; }
        .col-date { flex: 2.2; font-size: 13px; } .col-ven { flex: 2.5; } .col-amt { flex: 1.5; }
        .btn-pay { border: none; border-radius: 4px; padding: 10px 5px; color: white; font-weight: bold; background: var(--primary); width: 55px; font-size: 12px; }
        .btn-pay.is-paid { background: var(--success); }
        .btn-del { border: none; background: #eee; color: #333; width: 35px; border-radius: 4px; padding: 10px 5px; }
        .btn-add { background: var(--success); width: 100%; margin-top: 5px; padding: 10px; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 14px; }
        .footer-nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--primary); color: white; padding: 15px; display: flex; justify-content: center; text-align: center; border-top: 4px solid var(--success); z-index: 999; }
        .footer-nav span { font-size: 22px; font-weight: bold; color: #2ecc71; }
    </style>
</head>
<body>
<div class="scroll-container">
    <div class="container">
        <div class="controls">
            <select id="yearSelect" onchange="initApp()"></select>
            <select id="monthSelect" onchange="initApp()"></select>
        </div>
        <div class="summary-view">
            <div class="summary-grid">
                <div style="color:var(--danger)">Bills: <span id="sumBills">$0</span></div>
                <div style="color:var(--success)">Income: <span id="sumInc">$0</span></div>
            </div>
        </div>
        <div id="weeksContainer"></div>
        <button onclick="if(confirm('Clear all data?')) { localStorage.clear(); location.reload(); }" style="background:none; border:none; color:#ccc; width:100%; margin:20px 0; font-size: 12px;">Hard Reset App</button>
    </div>
</div>
<div class="footer-nav">
    <div>Monthly Balance: <br><span id="totalBal">$0</span></div>
</div>
<script>
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    function populateSelectors() {
        const ys = document.getElementById('yearSelect');
        const ms = document.getElementById('monthSelect');
        if(ys.options.length > 0) return;
        for(let y=2024; y<=2030; y++) ys.innerHTML += `<option value="${y}">${y}</option>`;
        months.forEach((m, i) => ms.innerHTML += `<option value="${i}">${m}</option>`);
        const today = new Date();
        ys.value = today.getFullYear(); ms.value = today.getMonth();
    }
    function getWeekRanges(year, month) {
        let result = [];
        let firstDay = new Date(year, month, 1);
        let lastDay = new Date(year, month + 1, 0);
        let start = new Date(firstDay);
        start.setDate(firstDay.getDate() - firstDay.getDay());
        while (start <= lastDay) {
            let end = new Date(start);
            end.setDate(start.getDate() + 6);
            result.push({ start: new Date(start), end: end });
            start.setDate(start.getDate() + 7);
        }
        return result;
    }
    function initApp() {
        const year = document.getElementById('yearSelect').value;
        const month = document.getElementById('monthSelect').value;
        const container = document.getElementById('weeksContainer');
        container.innerHTML = '';
        const weekRanges = getWeekRanges(parseInt(year), parseInt(month));
        const storageKey = `tracker_vFinal_${year}_${month}`;
        const savedData = JSON.parse(localStorage.getItem(storageKey)) || {};
        weekRanges.forEach((range, idx) => {
            const wKey = `w${idx+1}`;
            const rangeStr = `${months[range.start.getMonth()].substring(0,3)} ${range.start.getDate()} - ${months[range.end.getMonth()].substring(0,3)} ${range.end.getDate()}`;
            let dateOpts = '';
            for(let d = new Date(range.start); d <= range.end; d.setDate(d.getDate()+1)) {
                let label = `${months[d.getMonth()].substring(0,3)} ${d.getDate()}`;
                dateOpts += `<option value="${label}">${label}</option>`;
            }
            const data = savedData[wKey] || { bills: [{},{}], budgets: [{}] };
            container.innerHTML += `
                <div class="week-block" id="block-${wKey}">
                    <div class="week-header"><span>WEEK ${idx+1}</span> <span>${rangeStr}</span></div>
                    <h3>Weekly Bills</h3>
                    <div class="rows-area" data-type="bill" data-dates='${dateOpts}'>${renderRows(data.bills, 'bill', dateOpts)}</div>
                    <button class="btn-add" onclick="addRow(this)">+ Add Bill</button>
                    <h3>Weekly Income</h3>
                    <div class="rows-area" data-type="budget" data-dates='${dateOpts}'>${renderRows(data.budgets, 'budget', dateOpts)}</div>
                    <button class="btn-add" onclick="addRow(this)">+ Add Income</button>
                </div>`;
        });
        calculate();
    }
    function renderRows(arr, type, dateOpts) {
        return arr.map(item => `
            <div class="row ${item.paid ? 'paid' : ''}">
                <select class="col-date">${dateOpts.replace(`value="${item.date}"`, `value="${item.date}" selected`)}</select>
                ${type === 'bill' ? `<input type="text" class="col-ven" placeholder="Vendor" value="${item.ven||''}" oninput="calculate()">` : 
                `<select class="col-ven" onchange="calculate()"><option value="">Source</option><option ${item.ven=='Delivery'?'selected':''}>Delivery</option><option ${item.ven=='T-Salary'?'selected':''}>T-Salary</option><option ${item.ven=='R-Salary'?'selected':''}>R-Salary</option></select>`}
                <input type="number" class="col-amt" placeholder="$" value="${item.amt||''}" oninput="calculate()">
                ${type==='bill'?`<button class="btn-pay ${item.paid?'is-paid':''}" onclick="togglePaid(this)">${item.paid?'Paid':'Pay'}</button>`:''}
                <button class="btn-del" onclick="this.parentElement.remove();calculate();">âœ•</button>
            </div>`).join('');
    }
    function addRow(btn) {
        const area = btn.previousElementSibling;
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = renderRows([{}], area.dataset.type, area.dataset.dates);
        area.appendChild(tempDiv.firstElementChild);
        calculate();
    }
    function togglePaid(btn) {
        btn.parentElement.classList.toggle('paid');
        btn.classList.toggle('is-paid');
        btn.innerText = btn.parentElement.classList.contains('paid') ? "Paid" : "Pay";
        calculate();
    }
    function calculate() {
        let mBill = 0, mInc = 0;
        let exportData = {};
        document.querySelectorAll('.week-block').forEach(block => {
            const wKey = block.id.replace('block-', '');
            let wB = 0, wI = 0;
            exportData[wKey] = { bills: [], budgets: [] };
            block.querySelectorAll('.row').forEach(row => {
                const type = row.parentElement.dataset.type;
                const amt = parseFloat(row.querySelector('.col-amt').value) || 0;
                const data = { date: row.querySelector('.col-date').value, ven: row.querySelector('.col-ven').value, amt: amt, paid: row.classList.contains('paid') };
                if(type === 'bill') { wB += amt; exportData[wKey].bills.push(data); }
                else { wI += amt; exportData[wKey].budgets.push(data); }
            });
            mBill += wB; mInc += wI;
        });
        document.getElementById('sumBills').innerText = "$" + mBill.toFixed(2);
        document.getElementById('sumInc').innerText = "$" + mInc.toFixed(2);
        document.getElementById('totalBal').innerText = "$" + (mInc - mBill).toFixed(2);
        localStorage.setItem(`tracker_vFinal_${document.getElementById('yearSelect').value}_${document.getElementById('monthSelect').value}`, JSON.stringify(exportData));
    }
    window.onload = () => { populateSelectors(); initApp(); };
</script>
</body>
</html>
