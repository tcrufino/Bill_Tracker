<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bill Tracker Sync</title>
    <script type="importmap">
    {
      "imports": {
        "firebase/app": "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js",
        "firebase/database": "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"
      }
    }
    </script>
    <style>
        :root { --primary: #2c3e50; --header-blue: #3498db; --success: #27ae60; --danger: #e74c3c; --dark-navy: #34495e; }
        body { font-family: -apple-system, sans-serif; background: #eef2f5; margin: 0; padding: 10px; padding-bottom: 100px; }
        
        /* LOGIN SCREEN */
        #loginOverlay { position: fixed; inset: 0; background: #2c3e50; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #loginOverlay h1 { margin-bottom: 5px; letter-spacing: 2px; }
        #loginOverlay input { padding: 15px; border-radius: 8px; border: none; width: 80%; max-width: 300px; margin: 20px 0; font-size: 18px; text-align: center; }
        #loginOverlay button { background: #3498db; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 200px; }

        /* APP CONTENT */
        #appContent { display: none; }
        .top-nav { background: var(--primary); padding: 12px; border-radius: 12px; display: flex; gap: 8px; margin-bottom: 15px; }
        .top-nav select { flex: 1; padding: 10px; border-radius: 8px; font-weight: bold; border: none; }
        
        .s-card { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .week-box { background: white; border-radius: 12px; margin-bottom: 15px; overflow: hidden; border: 1px solid #ddd; }
        .week-header { background: #3498db; color: white; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; }
        .row { display: flex; gap: 5px; padding: 8px; border-bottom: 1px solid #eee; align-items: center; }
        .row input { padding: 8px; border: 1px solid #ddd; border-radius: 5px; }
        .btn-pay { background: #34495e; color: white; border: none; padding: 8px 12px; border-radius: 5px; font-size: 10px; font-weight: bold; }
        .btn-pay.paid { background: #27ae60; }
        
        .footer { position: fixed; bottom: 0; left: 0; right: 0; background: var(--primary); padding: 20px; text-align: center; color: white; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <h1>BILL TRACKER</h1>
        <p>Access Secure Cloud Sync</p>
        <input type="password" id="passInput" placeholder="••••••••">
        <button id="unlockBtn">UNLOCK APP</button>
    </div>

    <div id="appContent">
        <div class="top-nav">
            <select id="yearSel"><option value="2025">2025</option><option value="2026">2026</option></select>
            <select id="monthSel">
                <option value="1">January</option><option value="11">November</option><option value="12">December</option>
            </select>
        </div>

        <div id="display"></div>

        <div class="footer">
            <div style="font-size: 10px; color: #bdc3c7;">MONTHLY REMAINING</div>
            <div id="remaining" style="font-size: 24px; font-weight: bold; color: #2ecc71;">$0.00</div>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "firebase/app";
    import { getDatabase, ref, onValue, update } from "firebase/database";

    const config = {
        apiKey: "AIzaSyBsnuuEo8KSHb7taPQMpEJw8XkQVv3qW6k",
        authDomain: "billtrackersync-88b7a.firebaseapp.com",
        databaseURL: "https://billtrackersync-88b7a-default-rtdb.firebaseio.com",
        projectId: "billtrackersync-88b7a",
        appId: "1:93682434120:web:c3f3c3b968f975fd37d87d"
    };

    const app = initializeApp(config);
    const db = getDatabase(app);
    let data = {};

    // 1. O botão UNLOCK agora só libera o app se a senha for "Olivia28"
    document.getElementById('unlockBtn').onclick = () => {
        const pass = document.getElementById('passInput').value;
        if(pass === "Olivia28") {
            localStorage.setItem('session', 'active');
            start();
        } else { alert("Wrong Password"); }
    };

    function start() {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('appContent').style.display = 'block';
        
        // 2. Carrega os dados reais do seu Firebase
        onValue(ref(db, 'data'), (snap) => {
            data = snap.val() || {};
            render();
        });
    }

    function render() {
        const y = document.getElementById('yearSel').value;
        const m = document.getElementById('monthSel').value;
        const monthData = (data[y] && data[y][m]) ? data[y][m] : {};
        const container = document.getElementById('display');
        container.innerHTML = '';
        let totalB = 0, totalI = 0;

        ["w1","w2","w3","w4","w5"].forEach(wk => {
            const w = monthData[wk] || {};
            let bHtml = '';
            
            if(w.bills) Object.entries(w.bills).forEach(([id, b]) => {
                totalB += parseFloat(b.amt || 0);
                bHtml += `<div class="row">
                    <span style="flex:1">${b.ven}</span>
                    <span style="width:60px">$${b.amt}</span>
                    <button class="btn-pay ${b.paid?'paid':''}" onclick="window.tgl('${y}','${m}','${wk}','${id}',${b.paid})">${b.paid?'PAID':'PAY'}</button>
                </div>`;
            });

            container.innerHTML += `<div class="week-box">
                <div class="week-header">${wk.toUpperCase()}</div>
                <div style="padding:10px">${bHtml || '<p style="color:#ccc; font-size:12px">No bills</p>'}</div>
            </div>`;
        });
        
        document.getElementById('remaining').innerText = `$${(totalI - totalB).toFixed(2)}`;
    }

    window.tgl = (y, m, w, id, status) => {
        update(ref(db, `data/${y}/${m}/${w}/bills/${id}`), { paid: !status });
    };

    // Auto-login se já estiver logado
    if(localStorage.getItem('session') === 'active') start();
</script>
</body>
</html>
