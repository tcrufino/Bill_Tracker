<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bill Tracker Pro</title>
    <style>
        :root { 
            --primary: #2c3e50;    
            --header-blue: #3498db; 
            --btn-blue: #2980b9;    
            --success: #27ae60; 
            --danger: #e74c3c; 
            --vivid-green: #b2ffc7; /* More vivid green for paid rows */
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #eef2f5; margin: 0; padding: 10px;
            overflow-x: hidden; width: 100vw; position: fixed; height: 100%; 
        }

        .scroll-container { height: 100%; overflow-y: auto; padding-bottom: 180px; box-sizing: border-box; }
        .container { max-width: 500px; margin: auto; }

        .controls { 
            background: var(--primary); padding: 12px; border-radius: 12px; 
            margin-bottom: 15px; display: flex; gap: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        select, input { 
            padding: 10px; border-radius: 8px; border: 1px solid #ddd; 
            font-size: 15px; width: 100%; box-sizing: border-box; outline: none;
            background-color: white;
        }

        .summary-view { 
            background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; 
            border-left: 5px solid var(--header-blue); box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
        }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        .summary-label { font-size: 11px; color: #7f8c8d; text-transform: uppercase; margin-bottom: 4px; }
        .summary-val { font-size: 18px; font-weight: bold; }

        .week-block { 
            background: white; border-radius: 15px; padding: 15px; 
            margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
        }
        .week-header { 
            background: var(--header-blue); color: white; padding: 10px; 
            border-radius: 8px; margin: -15px -15px 15px -15px; 
            font-size: 14px; display: flex; justify-content: center; gap: 20px; font-weight: 600;
        }

        h3 { font-size: 11px; margin: 15px 0 8px 0; color: #95a5a6; text-transform: uppercase; letter-spacing: 0.5px; }

        .row { display: flex; gap: 4px; margin-bottom: 8px; align-items: center; width: 100%; transition: background 0.3s; padding: 2px 0; }
        .row.paid { background: var(--vivid-green) !important; border-radius: 6px; }
        
        .col-date { flex: 0 0 65px; font-size: 13px; font-weight: 600; height: 42px; text-align: center; color: #333; } 
        .col-ven { flex: 1; font-weight: 500; height: 42px; min-width: 0; }  
        .col-amt { flex: 0 0 85px; font-weight: bold; height: 42px; text-align: right; }

        .btn-pay { 
            border: none; border-radius: 6px; color: white; 
            font-weight: bold; background: var(--primary); width: 45px; height: 42px; font-size: 11px;
        }
        .btn-pay.is-paid { background: var(--success); }
        .btn-del { border: none; background: #f1f1f1; color: #ccc; width: 30px; height: 42px; border-radius: 6px; font-size: 14px; }
        
        .btn-add { 
            background: var(--btn-blue); width: 100%; margin: 8px 0; padding: 12px; 
            color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 13px;
        }

        .weekly-sum-line { 
            display: flex; justify-content: space-between;
            font-size: 13px; font-weight: 600; 
            color: #7f8c8d; padding: 4px 0;
        }
        .weekly-balance-line {
            text-align: right; font-size: 15px; font-weight: 800;
            color: var(--primary); padding-top: 8px; margin-top: 5px; border-top: 1px solid #eee;
        }

        /* Monthly Vendor Summary Styling */
        .vendor-summary-card {
            background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 5px solid var(--primary);
        }
        .vendor-summary-row {
            display: flex; justify-content: space-between; padding: 10px 0;
            border-bottom: 1px solid #f1f1f1; font-size: 14px;
        }
        .vendor-summary-row:last-child { border: none; }
        .vendor-name { font-weight: 600; color: var(--primary); }
        .vendor-total { font-weight: 700; color: var(--danger); }

        .footer-nav { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: var(--primary); color: white; padding: 18px; 
            display: flex; flex-direction: column; align-items: center;
            border-top: 4px solid var(--success); z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
        }
        .footer-nav .label { font-size: 12px; opacity: 0.8; margin-bottom: 2px; }
        .footer-nav .balance { font-size: 28px; font-weight: 800; color: #2ecc71; }
    </style>
</head>
<body>

<div class="scroll-container">
    <div class="container">
        <div class="controls">
            <select id="yearSelect" onchange="initApp()"></select>
            <select id="monthSelect" onchange="initApp()"></select>
        </div>

        <div class="summary-view">
            <div class="summary-grid">
                <div>
                    <div class="summary-label">Monthly Bills</div>
                    <div class="summary-val" style="color:var(--danger)" id="sumBills">$0.00</div>
                </div>
                <div>
                    <div class="summary-label">Monthly Income</div>
                    <div class="summary-val" style="color:var(--success)" id="sumInc">$0.00</div>
                </div>
            </div>
        </div>

        <div id="weeksContainer"></div>

        <div class="vendor-summary-card">
            <h2 style="font-size: 16px; margin: 0 0 15px 0; color: var(--primary); text-align: center;">MONTHLY SPENDING BY VENDOR</h2>
            <div id="vendorSummaryList">
                </div>
        </div>
        
        <button onclick="if(confirm('Erase all saved data?')) { localStorage.clear(); location.reload(); }" 
                style="background:none; border:none; color:#bdc3c7; width:100%; margin:20px 0; font-size: 11px;">
            HARD RESET APP
        </button>
    </div>
</div>

<div class="footer-nav">
    <div class="label">MONTHLY REMAINING BALANCE</div>
    <div class="balance" id="totalBal">$0.00</div>
</div>

<script>
    const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    function fNum(n) {
        return n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function populateSelectors() {
        const ys = document.getElementById('yearSelect');
        const ms = document.getElementById('monthSelect');
        if(ys.options.length > 0) return;
        for(let y=2024; y<=2030; y++) ys.innerHTML += `<option value="${y}">${y}</option>`;
        months.forEach((m, i) => ms.innerHTML += `<option value="${i}">${m}</option>`);
        const today = new Date();
        ys.value = today.getFullYear(); ms.value = today.getMonth();
    }

    function getWeekRanges(year, month) {
        let result = [];
        let firstDay = new Date(year, month, 1);
        let lastDay = new Date(year, month + 1, 0);
        let start = new Date(firstDay);
        start.setDate(firstDay.getDate() - firstDay.getDay());
        while (start <= lastDay) {
            let end = new Date(start);
            end.setDate(start.getDate() + 6);
            result.push({ start: new Date(start), end: end });
            start.setDate(start.getDate() + 7);
        }
        return result;
    }

    function initApp() {
        const year = document.getElementById('yearSelect').value;
        const month = document.getElementById('monthSelect').value;
        const container = document.getElementById('weeksContainer');
        container.innerHTML = '';

        const weekRanges = getWeekRanges(parseInt(year), parseInt(month));
        const storageKey = `tracker_vFinal_${year}_${month}`;
        const savedData = JSON.parse(localStorage.getItem(storageKey)) || {};

        weekRanges.forEach((range, idx) => {
            const wKey = `w${idx+1}`;
            const rangeStr = `${months[range.start.getMonth()].substring(0,3)} ${range.start.getDate()} - ${months[range.end.getMonth()].substring(0,3)} ${range.end.getDate()}`;
            
            let dateOpts = '';
            for(let d = new Date(range.start); d <= range.end; d.setDate(d.getDate()+1)) {
                let label = `${d.getDate()} ${months[d.getMonth()].substring(0,3)}`;
                dateOpts += `<option value="${label}">${label}</option>`;
            }

            const data = savedData[wKey] || { bills: [{},{}], budgets: [{}] };

            container.innerHTML += `
                <div class="week-block" id="block-${wKey}">
                    <div class="week-header">
                        <span>WEEK ${idx+1}</span>
                        <span>${rangeStr}</span>
                    </div>
                    
                    <h3>Weekly Bills</h3>
                    <div class="rows-area" data-type="bill" data-dates='${dateOpts}'>${renderRows(data.bills, 'bill', dateOpts)}</div>
                    <button class="btn-add" onclick="addRow(this)">+ Add Bill</button>
                    <div class="weekly-sum-line"><span>Bills:</span> <span class="w-bill-total">$0.00</span></div>
                    
                    <h3>Weekly Income</h3>
                    <div class="rows-area" data-type="budget" data-dates='${dateOpts}'>${renderRows(data.budgets, 'budget', dateOpts)}</div>
                    <button class="btn-add" onclick="addRow(this)">+ Add Income</button>
                    <div class="weekly-sum-line"><span>Income:</span> <span class="w-inc-total">$0.00</span></div>

                    <div class="weekly-balance-line">Week Balance: <span class="w-bal-total">$0.00</span></div>
                </div>`;
        });
        calculate();
    }

    function renderRows(arr, type, dateOpts) {
        return arr.map(item => `
            <div class="row ${item.paid ? 'paid' : ''}">
                <select class="col-date">${dateOpts.replace(`value="${item.date}"`, `value="${item.date}" selected`)}</select>
                ${type === 'bill' ? 
                    `<input type="text" class="col-ven" placeholder="Vendor" value="${item.ven||''}" oninput="calculate()">` : 
                    `<select class="col-ven" onchange="calculate()">
                        <option value="">Source</option>
                        <option ${item.ven=='Delivery'?'selected':''}>Delivery</option>
                        <option ${item.ven=='T-Salary'?'selected':''}>T-Salary</option>
                        <option ${item.ven=='R-Salary'?'selected':''}>R-Salary</option>
                    </select>`
                }
                <input type="number" class="col-amt" placeholder="0" value="${item.amt||''}" oninput="calculate()" step="0.01">
                ${type==='bill'?`<button class="btn-pay ${item.paid?'is-paid':''}" onclick="togglePaid(this)">${item.paid?'Paid':'Pay'}</button>`:''}
                <button class="btn-del" onclick="this.parentElement.remove();calculate();">âœ•</button>
            </div>`).join('');
    }

    function addRow(btn) {
        const area = btn.previousElementSibling;
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = renderRows([{}], area.dataset.type, area.dataset.dates);
        area.appendChild(tempDiv.firstElementChild);
        calculate();
    }

    function togglePaid(btn) {
        btn.parentElement.classList.toggle('paid');
        btn.classList.toggle('is-paid');
        btn.innerText = btn.parentElement.classList.contains('paid') ? "Paid" : "Pay";
        calculate();
    }

    function calculate() {
        let mBill = 0, mInc = 0;
        let exportData = {};
        let vendorMap = {}; // To store totals for the summary
        
        document.querySelectorAll('.week-block').forEach(block => {
            const wKey = block.id.replace('block-', '');
            let wB = 0, wI = 0;
            exportData[wKey] = { bills: [], budgets: [] };
            
            block.querySelectorAll('.row').forEach(row => {
                const type = row.parentElement.dataset.type;
                const amtStr = row.querySelector('.col-amt').value;
                const amt = parseFloat(amtStr) || 0;
                const ven = row.querySelector('.col-ven').value;
                const isPaid = row.classList.contains('paid');

                const data = { 
                    date: row.querySelector('.col-date').value, 
                    ven: ven, 
                    amt: amt, 
                    paid: isPaid 
                };
                
                if(type === 'bill') { 
                    wB += amt; 
                    exportData[wKey].bills.push(data);
                    // Add to Vendor Summary if it has a name
                    if(ven.trim() !== "") {
                        vendorMap[ven] = (vendorMap[ven] || 0) + amt;
                    }
                }
                else { 
                    wI += amt; 
                    exportData[wKey].budgets.push(data); 
                }
            });

            block.querySelector('.w-bill-total').innerText = "$" + fNum(wB);
            block.querySelector('.w-inc-total').innerText = "$" + fNum(wI);
            block.querySelector('.w-bal-total').innerText = "$" + fNum(wI - wB);
            
            mBill += wB; mInc += wI;
        });

        document.getElementById('sumBills').innerText = "$" + fNum(mBill);
        document.getElementById('sumInc').innerText = "$" + fNum(mInc);
        document.getElementById('totalBal').innerText = "$" + fNum(mInc - mBill);
        
        // Render Vendor Summary
        const summaryList = document.getElementById('vendorSummaryList');
        summaryList.innerHTML = '';
        const sortedVendors = Object.keys(vendorMap).sort((a,b) => vendorMap[b] - vendorMap[a]);
        
        if(sortedVendors.length === 0) {
            summaryList.innerHTML = '<div style="text-align:center; color:#999; font-size:12px;">No bills entered yet.</div>';
        } else {
            sortedVendors.forEach(v => {
                summaryList.innerHTML += `
                    <div class="vendor-summary-row">
                        <span class="vendor-name">${v}</span>
                        <span class="vendor-total">$${fNum(vendorMap[v])}</span>
                    </div>`;
            });
        }

        localStorage.setItem(`tracker_vFinal_${document.getElementById('yearSelect').value}_${document.getElementById('monthSelect').value}`, JSON.stringify(exportData));
    }

    window.onload = () => { populateSelectors(); initApp(); };
</script>
</body>
</html>
